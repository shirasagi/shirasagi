<%= jquery do %>
  SS_AjaxFile.errors.entityTooLarge = "<%= I18n.t('errors.messages.request_entity_too_large') %>";
  new SS_AjaxFile(null, { indexPath: "<%= url_for(action: :index, file_size: params[:file_size]) %>" });
  SS_SearchUI.modal();
<% end %>

<% if @model.allowed?(:edit, @cur_user, site: @cur_site, node: @cur_node) %>
  <%= form_for :item, url: { action: :create }, html: { class: "user-file", multipart: true } do |f| %>
  <%= error_messages_for :item %>

    <div class="search-ui-form">
      <%= f.file_field :in_files, multiple: :multiple, required: :required %>
      <%= f.select :resizing, @model.resizing_options, { include_blank: t("ss.resize_image") }, { class: "image-size" } %>
      <%= f.submit t("ss.buttons.attach"), class: "save btn", style: "margin-left: 10px;", "data-submitted": "attach" %>
      <%= f.submit t("ss.buttons.save"), class: "save btn", style: "margin-left: 10px;", "data-submitted": "save" %>
    </div>

  <% end %>
<% end %>

<div class="index user-files">
  <% @items.each do |item| %>
  <article class="file-view" id="user-file<%= item.id %>" data-file-id="<%= item.id %>">
    <%= sanitizer_status(item) %>
    <%
      opts = { action: :select, id: item }
      opts[:file_size] = true if params[:file_size].present?
    %>
    <a class="select" href="<%= url_for opts %>" title="<%= item.humanized_name %>" data-id="<%= item.id %>" data-humanized-name="<%= item.humanized_name %>">
      <div class="thumb">
        <% if item.image? %>
          <img src="<%= url_for(action: :thumb, id: item, _: item.updated.to_i) %>" alt="<%= item.basename %>" />
        <% else %>
          <span class="ext icon-<%= item.extname %>"><%= item.extname %></span>
        <% end %>
      </div>
      <div class="name">
        <%= item.name %>
        <% if params[:file_size] %>
        <br />
        <span class="file-size"><%= "( #{number_to_human_size(item.size)} )" %></span>
        <% end %>
      </div>
    </a>
    <nav class="menu">
      <% if item.allowed?(:edit, @cur_user, site: @cur_site) %>
        <%= link_to t("ss.buttons.edit"), { action: :edit, id: item, file_size: params[:file_size] }, class: %w(edit ajax-box) %>
      <% end %>
      <% if item.allowed?(:delete, @cur_user, site: @cur_site) %>
        <%= link_to t("ss.buttons.delete"), { action: :destroy, id: item }, class: "delete", "data-remove" => "#user-file#{item.id}" %>
      <% end %>
    </nav>
  </article>
  <% end %>
</div>

<div style="clear: both;"></div>

<%= paginate @items if @items.try(:current_page) %>
