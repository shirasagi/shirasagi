<%
  return if !@item.allowed?(:edit, @cur_user, site: @cur_site) && !@cur_user.cms_role_permit_any?(@cur_site, :read_cms_body_usages)

  addon ||= local_assigns.fetch(:addon, {})
%>

<dl class="see">
  <dt><%= @model.t :usage_node_count %></dt>
  <dd><span class="cms-usage-node-count"><%= @item.usage_node_count.try { |v| v.to_s(:delimited) } || '-' %></span></dd>

  <dt><%= @model.t :usage_page_count %></dt>
  <dd><span class="cms-usage-page-count"><%= @item.usage_page_count.try { |v| v.to_s(:delimited) } || '-' %></span></dd>

  <dt><%= @model.t :usage_file_count %></dt>
  <dd><span class="cms-usage-file-count"><%= @item.usage_file_count.try { |v| v.to_s(:delimited) } || '-' %></span></dd>

  <dt><%= @model.t :usage_db_size %></dt>
  <dd><span class="cms-usage-db-size"><%= @item.usage_db_size.try { |v| v.to_s(:human_size) } || '-' %></span></dd>

  <dt><%= @model.t :usage_group_count %></dt>
  <dd><span class="cms-usage-group-count"><%= @item.usage_group_count.try { |v| v.to_s(:delimited) } || '-' %></span></dd>

  <dt><%= @model.t :usage_user_count %></dt>
  <dd><span class="cms-usage-user-count"><%= @item.usage_user_count.try { |v| v.to_s(:delimited) } || '-' %></span></dd>

  <dt><%= @model.t :usage_calculated_at %></dt>
  <dd><span class="cms-usage-calculated-at"><%= @item.usage_calculated_at.try { |v| I18n.l(v) } || '-' %></span></dd>
</dl>

<% if @item.allowed?(:edit, @cur_user, site: @cur_site) %>
<%= button_tag(t('service.buttons.reload'), name: "reload", type: "button", class: "btn btn-reload-cms-usages", data: { href: cms_apis_reload_site_usages_path(format: "json") }) %>
<% end %>

<%= jquery do %>
  new Cms_Usage("#<%= addon[:id] %>")
<% end %>
