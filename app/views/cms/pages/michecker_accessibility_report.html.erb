<%
  limit = 5
  return if @accessibility_result.blank?
%>

<%= render "ss/crud/addon", addon: { head: "種別", class: "michecker-report__filter" } do %>
  <ul class="michecker-report__filter-items">
    <% all_count, error_count, warning_count, caution_count, notice_count = @accessibility_result.aggregate_counts %>
    <li class="michecker-report__filter-item-all">すべての項目 <span class="michecker-report__filter-item-badge"><%= all_count %></span></li>
    <li class="michecker-report__filter-item-separator"><hr></li>
    <li class="michecker-report__filter-item-error">問題あり <span class="michecker-report__filter-item-badge"><%= error_count %></span></li>
    <li class="michecker-report__filter-item-warning">問題の可能性大 <span class="michecker-report__filter-item-badge"><%= warning_count %></span></li>
    <li class="michecker-report__filter-item-caution">要判断箇所 <span class="michecker-report__filter-item-badge"><%= caution_count %></span></li>
    <li class="michecker-report__filter-item-notice">手動確認 <span class="michecker-report__filter-item-badge"><%= notice_count %></span></li>
  </ul>
<% end %>

<%= render "ss/crud/addon", addon: { class: "michecker-report__result" } do %>
  <div class="michecker-report__result-container">
    <div class="michecker-report__result-controller">
      <button type="button" class="btn"><span class="material-icons md-13">settings</span> 表示列設定</button>
      <a class="btn btn-michecker-report-download" href="<%= url_for(action: "michecker_result", type: "accessibility_report", _: @result.updated.to_i, format: "csv") %>"><span class="material-icons md-13">get_app</span> CSVダウンロード</a>
    </div>

    <table class="index" style="width: 140em;">
      <thead>
      <tr>
        <th style="width: 12em;"><%= Cms::Michecker::Accessibility.t :severityStr %></th>
        <% if false %><th style="width: 12em;"><%= Cms::Michecker::Accessibility.t :evaluationItem_tableDataMetrics0 %></th><% end %>
        <% if false %><th style="width: 12em;"><%= Cms::Michecker::Accessibility.t :evaluationItem_tableDataMetrics1 %></th><% end %>
        <% if false %><th style="width: 12em;"><%= Cms::Michecker::Accessibility.t :evaluationItem_tableDataMetrics2 %></th><% end %>
        <% if false %><th style="width: 12em;"><%= Cms::Michecker::Accessibility.t :evaluationItem_tableDataMetrics3 %></th><% end %>
        <% if false %><th style="width: 12em;"><%= Cms::Michecker::Accessibility.t :evaluationItem_tableDataGuideline0 %></th><% end %>
        <% if false %><th style="width: 12em;"><%= Cms::Michecker::Accessibility.t :evaluationItem_tableDataGuideline1 %></th><% end %>
        <% if false %><th style="width: 12em;"><%= Cms::Michecker::Accessibility.t :evaluationItem_tableDataGuideline2 %></th><% end %>
        <th style="width: 12em;"><%= Cms::Michecker::Accessibility.t :evaluationItem_tableDataTechniques %></th>
        <th style="width: 12em;"><%= Cms::Michecker::Accessibility.t :highlightTargetPaths %></th>
        <th><%= Cms::Michecker::Accessibility.t :description %></th>
      </tr>
      </thead>
      <tbody>
      <% @accessibility_result.items.each_with_index do |item, index| %>
        <tr <% if item.highlightTargetPaths.present? && item.highlightTargetPaths.length == 1 %>data-css-path="<%= item.highlightTargetPaths.first["cssPath"] %>"<% end %> <% if index >= limit %>class="hide"<% end %>>
          <td><%= item.severityStr %></td>
          <% if false %><td><%= item.evaluationItem["tableDataMetrics"].try { |metrics| metrics[0] } %></td><% end %>
          <% if false %><td><%= item.evaluationItem["tableDataMetrics"].try { |metrics| metrics[1] } %></td><% end %>
          <% if false %><td><%= item.evaluationItem["tableDataMetrics"].try { |metrics| metrics[2] } %></td><% end %>
          <% if false %><td><%= item.evaluationItem["tableDataMetrics"].try { |metrics| metrics[3] } %></td><% end %>
          <% if false %><td><%= item.evaluationItem["tableDataGuideline"].try { |metrics| metrics[0] } %></td><% end %>
          <% if false %><td><%= item.evaluationItem["tableDataGuideline"].try { |metrics| metrics[1] } %></td><% end %>
          <% if false %><td><%= item.evaluationItem["tableDataGuideline"].try { |metrics| metrics[2] } %></td><% end %>
          <td><%= item.evaluationItem["tableDataTechniques"] %></td>
          <td>
            <% if item.highlightTargetPaths.present? %>
              <% item.highlightTargetPaths.each_with_index do |highlightTargetPath, index| %>
                <span class="michecker-report__result-html-problem-element" data-css-path="<%= highlightTargetPath["cssPath"] %>"><%= index + 1 %></span>
              <% end %>
            <% end %>
          </td>
          <td><%= item.description %></td>
        </tr>
      <% end %>
      </tbody>
      <tfoot>
        <tr class="top">
          <td colspan="4">
            <%= @accessibility_result.items.count.to_s(:delimited) %>件中<%= limit.to_s(:delimited) %>件を表示しています。
            <a class="michecker-report__result-show-all">すべて表示</a>
          </td>
        </tr>
        <tr class="all hide">
          <td colspan="4">
            <%= @accessibility_result.items.count.to_s(:delimited) %>件表示しています。
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
<% end %>
