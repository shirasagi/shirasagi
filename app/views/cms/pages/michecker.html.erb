<div class="michecker" id="ss-michecker">
  <div class="michecker__main">
    <iframe class="michecker__main-content" src="<%= cms_preview_path(path: @item.url[1..-1], "no-controller" => true) %>" frameborder="none"></iframe>
  </div>
  <div class="michecker__footer">
    <div class="michecker-report__selector">
      <select name="report-type">
        <option value="accessibility">アクセシビリティ検証</option>
        <option value="low-vision">視覚化</option>
      </select>
      <a href="#ss-michecker" class="michecker-settings"><span class="material-icons">settings</span></a>
    </div>

    <div class="michecker-report__accessibility">
      <%= render "ss/crud/addon", addon: { head: "種別", class: "michecker-report__filter" } do %>
        <ul class="michecker-report__filter-items">
          <% all_count, error_count, warning_count, caution_count, notice_count = @accessibility_result.aggregate_counts %>
          <li class="michecker-report__filter-item-all">すべての項目 <span class="michecker-report__filter-item-badge"><%= all_count %></span></li>
          <li class="michecker-report__filter-item-separator"><hr></li>
          <li class="michecker-report__filter-item-error">問題あり <span class="michecker-report__filter-item-badge"><%= error_count %></span></li>
          <li class="michecker-report__filter-item-warning">問題の可能性大 <span class="michecker-report__filter-item-badge"><%= warning_count %></span></li>
          <li class="michecker-report__filter-item-caution">要判断箇所 <span class="michecker-report__filter-item-badge"><%= caution_count %></span></li>
          <li class="michecker-report__filter-item-notice">手動確認 <span class="michecker-report__filter-item-badge"><%= notice_count %></span></li>
        </ul>
      <% end %>

      <%= render "ss/crud/addon", addon: { class: "michecker-report__result" } do %>
        <div class="michecker-report__result-container">
          <table class="index" style="width: 140em;">
            <thead>
            <tr>
              <th style="width: 12em;">知覚可能</th>
              <th style="width: 12em;">操作可能</th>
              <th style="width: 12em;">理解可能</th>
              <th style="width: 12em;">堅牢</th>
              <th style="width: 12em;">WCAG 2.0</th>
              <th style="width: 12em;">Section508</th>
              <th style="width: 12em;">JIS</th>
              <th style="width: 12em;">達成方法</th>
              <th>内容</th>
            </tr>
            </thead>
            <tbody>
            <% @accessibility_result.items.each do |item| %>
              <tr>
                <td><%= item.evaluationItem["tableDataMetrics"].try { |metrics| metrics[0] } %></td>
                <td><%= item.evaluationItem["tableDataMetrics"].try { |metrics| metrics[1] } %></td>
                <td><%= item.evaluationItem["tableDataMetrics"].try { |metrics| metrics[2] } %></td>
                <td><%= item.evaluationItem["tableDataMetrics"].try { |metrics| metrics[3] } %></td>
                <td><%= item.evaluationItem["guidelines"].select { |guideline| guideline["guidelineName"] == "WCAG 2.0" }.map { |guideline| guideline["id"] }.join(", ") %></td>
                <td><%= item.evaluationItem["guidelines"].select { |guideline| guideline["guidelineName"] == "Section508" }.map { |guideline| guideline["id"] }.join(", ") %></td>
                <td><%= item.evaluationItem["guidelines"].select { |guideline| guideline["guidelineName"] == "JIS" }.map { |guideline| guideline["id"] }.join(", ") %></td>
                <td><%= item.evaluationItem["tableDataTechniques"] %></td>
                <td><%= item.description %></td>
              </tr>
            <% end %>
            </tbody>
          </table>
        </div>
      <% end %>
    </div>

    <div class="michecker-report__low-vision hide">
      <%= render "ss/crud/addon", addon: { head: "種別", class: "michecker-report__filter" } do %>
        <ul class="michecker-report__filter-items">
          <% all_count, error_count, warning_count, caution_count, notice_count = @lowvision_result.aggregate_counts %>
          <li class="michecker-report__filter-item-all">すべての項目 <span class="michecker-report__filter-item-badge"><%= all_count %></span></li>
          <li class="michecker-report__filter-item-separator"><hr></li>
          <li class="michecker-report__filter-item-error">問題あり <span class="michecker-report__filter-item-badge"><%= error_count %></span></li>
          <li class="michecker-report__filter-item-warning">問題の可能性大 <span class="michecker-report__filter-item-badge"><%= warning_count %></span></li>
          <li class="michecker-report__filter-item-caution">要判断箇所 <span class="michecker-report__filter-item-badge"><%= caution_count %></span></li>
          <li class="michecker-report__filter-item-notice">手動確認 <span class="michecker-report__filter-item-badge"><%= notice_count %></span></li>
        </ul>
      <% end %>

      <%= render "ss/crud/addon", addon: { class: "michecker-report__result" } do %>
        <div class="michecker-report__result-container">
          <table class="index" style="width: 170em;">
            <thead>
            <tr>
              <th style="width: 12em;">種類</th>
              <th style="width: 12em;">WCAG 2.0</th>
              <th style="width: 12em;">Section508</th>
              <th style="width: 12em;">JIS</th>
              <th style="width: 12em;">深刻度</th>
              <th style="width: 12em;">前景色</th>
              <th style="width: 12em;">背景色</th>
              <th style="width: 12em;">X座標</th>
              <th style="width: 12em;">Y座標</th>
              <th style="width: 12em;">面積</th>
              <th style="width: 12em;">達成方法</th>
              <th>内容</th>
            </tr>
            </thead>
            <tbody>
            <% @lowvision_result.items.each do |item| %>
              <tr>
                <td><%= item.iconTooltip %></td>
                <td><%= item.evaluationItem["guidelines"].select { |guideline| guideline["guidelineName"] == "WCAG 2.0" }.map { |guideline| guideline["id"] }.join(", ") %></td>
                <td><%= item.evaluationItem["guidelines"].select { |guideline| guideline["guidelineName"] == "Section508" }.map { |guideline| guideline["id"] }.join(", ") %></td>
                <td><%= item.evaluationItem["guidelines"].select { |guideline| guideline["guidelineName"] == "JIS" }.map { |guideline| guideline["id"] }.join(", ") %></td>
                <td><%= item.severityLV %></td>
                <td><%= item.foreground %></td>
                <td><%= item.background %></td>
                <td><%= item.x %></td>
                <td><%= item.y %></td>
                <td><%= item.area %></td>
                <td><%= item.evaluationItem["tableDataTechniques"] %></td>
                <td><%= item.description %></td>
              </tr>
            <% end %>
            </tbody>
          </table>
        </div>
      <% end %>
    </div>
  </div>

  <%= jquery do %>
    $(".michecker-report__selector [name=report-type]").on("change", function() {
      var $this = $(this);
      var target = $this.val();
      if (! target) {
        return;
      }

      if (target === "accessibility") {
        $(".michecker-report__accessibility").removeClass("hide");
        $(".michecker-report__low-vision").addClass("hide");
      } else {
        $(".michecker-report__accessibility").addClass("hide");
        $(".michecker-report__low-vision").removeClass("hide");
      }
    });

    $(".michecker-settings").on("click", function(ev) {
      ev.preventDefault();

      $.colorbox({
        html: "<h2>miCheck の設定</h2><div>ただいま開発中。</div>", fixed: true, width: "90%", height: "90%"
      });
    });
  <% end %>
</div>
