<%
  action = params[:action]
  is_changeable = permitted && (item.try(:state_changeable?) || action == "destroy_all")
%>
<% if permitted %>
  <li class="list-item" data-id="<%= item.id %>">
    <label class="check">
      <%= check_box_tag "ids[]", item.id, true %>
    </label>
    <div class="info">
      <% if is_changeable %>
        <%= f.hidden_field_tag 'ids[]', item.id.to_s, id: nil %>
      <% end %>
      <% show_path = url_for(action: :show, id: item) rescue nil %>
      <% if show_path %>
        <%= link_to item.try(:name), show_path, class: "title", target: "_blank", rel: "noopener" %>
      <% else %>
        <%= link_to item.try(:name), { action: :show, id: item }, class: "title", target: "_blank", rel: "noopener" %>
      <% end %>
      <% if item.errors.present? %>
        <div class="error-message">
          <% item.errors.full_messages.each do |message| %>
            <p><%= message %></p>
          <% end %>
        </div>
      <% end %>
      <div class="meta">
        <%= render "cms/crud/destroy_info", item: item, action: action %>
        <% if item.try(:tags) %>
          <span class="tags"><%= item.tags.join(",") %></span>
        <% end %>
      </div>
    </div>
  </li>
<% else %>
  <li class="list-item" data-id="<%= item.id %>">
    <label class="check">
      <%= check_box_tag "ids[]", item.id, false, disabled: true %>
    </label>
    <div class="info">
      <% if is_changeable %>
        <%= f.hidden_field_tag 'ids[]', item.id.to_s, id: nil %>
      <% end %>
      <% show_path = url_for(action: :show, id: item) rescue nil %>
      <% if show_path %>
        <%= link_to item.try(:name), show_path, class: "title", target: "_blank", rel: "noopener" %>
      <% else %>
        <%= link_to item.try(:name), { action: :show, id: item }, class: "title", target: "_blank", rel: "noopener" %>
      <% end %>
      <div class="error-message">
        <p><%= message %></p>
      </div>
      <div class="meta">
        <%= render "cms/crud/destroy_info", item: item, action: action %>
        <% if item.try(:tags) %>
          <span class="tags"><%= item.tags.join(",") %></span>
        <% end %>
      </div>
    </div>
  </li>
<% end %>
