<%= jquery do %>
SS_Notice.renderNotice("<%= flash[:notice] %>", { type: "notice" });
<% end %>

<div class="cms-tabs">
  <%= link_to cms_all_contents_download_path do %>
    <span class="tab-name"><%= t("cms.all_content.download_tab") %></span>
  <% end %>
  <%= link_to cms_all_contents_import_path do %>
    <span class="tab-name"><%= t("cms.all_content.import_tab") %></span>
  <% end %>
  <%= link_to cms_all_contents_sampling_path do %>
    <span class="tab-name"><%= t("cms.all_content.sampling_tab") %></span>
  <% end %>
  <%= link_to cms_all_contents_moves_path, class: 'current' do %>
    <span class="tab-name"><%= t("cms.all_content.moves_tab") %></span>
  <% end %>
</div>

<%
  # アクティブなタスクとステータスメッセージを決定
  active_task = nil
  status_message_key = nil

  if @task&.running? || @task&.ready?
    # チェックジョブが動作中の場合は常に最優先で表示
    active_task = @task
    status_message_key = 'cms.all_contents_moves.status.reading_csv'
  elsif @check_result
    # チェック結果がある場合
    if @execute_result
      # 実行結果がある場合は結果を表示（タスクは表示しない）
    elsif @execute_task&.running? || @execute_task&.ready?
      active_task = @execute_task
      status_message_key = 'cms.all_contents_moves.status.executing'
    end
  elsif @execute_task&.running? || @execute_task&.ready?
    active_task = @execute_task
    status_message_key = 'cms.all_contents_moves.status.executing'
  end
%>

<% if active_task %>
  <%= render "cms/all_contents_moves/job_status",
      task: active_task,
      url: job_cms_task_path(id: active_task.id, format: :json),
      status_message: t(status_message_key),
      job_log_path: job_cms_task_path(id: active_task.id),
      on_complete: "setTimeout(function() { location.reload(); }, 1000);" %>
<% end %>

<% if @check_result %>
  <% if @execute_result %>
    <%= render "execute_result" %>
  <% else %>
    <%= render "check_result" %>
  <% end %>
<% elsif !active_task %>
  <%= render "upload_form" %>
<% end %>
