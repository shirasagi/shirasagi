<%= jquery do %>
SS_Notice.renderNotice("<%= flash[:notice] %>", { type: "notice" });
<% end %>

<div class="cms-tabs">
  <%= link_to cms_all_contents_download_path do %>
    <span class="tab-name"><%= t("cms.all_content.download_tab") %></span>
  <% end %>
  <%= link_to cms_all_contents_import_path do %>
    <span class="tab-name"><%= t("cms.all_content.import_tab") %></span>
  <% end %>
  <%= link_to cms_all_contents_sampling_path do %>
    <span class="tab-name"><%= t("cms.all_content.sampling_tab") %></span>
  <% end %>
  <%= link_to cms_all_contents_moves_path, class: 'current' do %>
    <span class="tab-name"><%= t("cms.all_content.moves_tab") %></span>
  <% end %>
</div>

<% if @check_result %>
  <% if @execute_result %>
    <%= render "execute_result" %>
  <% else %>
    <%# ページ移動ジョブが実行中の場合、先頭に状態を表示 %>
    <% if @execute_task && (@execute_task.running? || @execute_task.ready?) %>
      <%= render "cms/all_contents_moves/job_status", 
          task: @execute_task, 
          url: job_cms_task_path(id: @execute_task.id, format: :json),
          status_message: t('cms.all_contents_moves.status.executing'),
          job_log_path: job_cms_task_path(id: @execute_task.id),
          on_complete: "setTimeout(function() { location.reload(); }, 1000);" %>
    <% end %>
    <%= render "check_result" %>
  <% end %>
<% elsif @task.running? || @task.ready? %>
  <%= render "cms/all_contents_moves/job_status", 
      task: @task, 
      url: job_cms_task_path(id: @task.id, format: :json),
      status_message: t('cms.all_contents_moves.status.reading_csv'),
      job_log_path: job_cms_task_path(id: @task.id),
      on_complete: "setTimeout(function() { location.reload(); }, 1000);" %>
<% elsif @execute_task && (@execute_task.running? || @execute_task.ready?) %>
  <%= render "cms/all_contents_moves/job_status", 
      task: @execute_task, 
      url: job_cms_task_path(id: @execute_task.id, format: :json),
      status_message: t('cms.all_contents_moves.status.executing'),
      job_log_path: job_cms_task_path(id: @execute_task.id),
      on_complete: "setTimeout(function() { location.reload(); }, 1000);" %>
<% else %>
  <%= render "upload_form" %>
<% end %>
