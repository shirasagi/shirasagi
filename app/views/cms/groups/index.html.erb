<%= jquery do %>
SS_TreeUI.render(".index.groups");
$(".index.groups tbody tr[data-depth='1'] img").click();
<% end %>

<div class="list-search">
  <%= render file: "_search" %>
</div>

<div class="main-box">
  <table class="index groups">
    <thead>
      <tr>
        <th><%= @model.t :name %></th>
        <th class="datetime"><%= @model.t :updated %></th>
      </tr>
    </thead>

    <tbody>
      <% @items.each do |item| %>
      <% keyword = params[:s][:keyword] rescue nil %>
      <% depth   = keyword.present? ? "" : %( data-depth=#{item.name.count("/") + 1}) %>
      <% name    = keyword.present? ? item.trailing_name : item.name %>
      <tr<%= depth %>>
        <nav class="tap-menu">
          <%= link_to :show, action: :show, id: item %>
          <%= link_to :edit, action: :edit, id: item if item.allowed?(:edit, @cur_user, site: @cur_site) %>
          <%= link_to :delete, action: :delete, id: item if item.allowed?(:edit, @cur_user, site: @cur_site) %>
        </nav>
        <td class="expandable">
          <%= link_to item.name, { action: :show, id: item}, class: "title" %>
        </td>
        <td><%= item.updated.strftime("%Y/%m/%d") %></td>
      </tr>
      <% end %>
    </tbody>
  </table>
</div>

<%= paginate @items if @items.try(:current_page) %>
