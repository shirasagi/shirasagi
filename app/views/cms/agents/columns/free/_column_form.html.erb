<% value ||= nil %>
<% controller ||= false %>
<% source_cleaner_conf = Cms::SourceCleanerTemplate.site(@cur_site).and_public.to_config %>
<%= render 'cms/agents/columns/main/base', f: f, column: column, value: value, controller: controller do |id| %>
  <% editor_id = "#{id}-html" %>
  <%= text_area_tag("#{f.object_name}[][in_wrap][value]", value.try(:value), column.form_options.merge(id: editor_id, class: "html", style: "height: 400px;")) %>
  <%= html_editor "##{editor_id}", advanced: Cms::EditorExtension.allowed?(:use, @cur_user, site: @cur_site) %>

  <div class="inplace-checkers">
    <% if @inplace_syntax_check %>
      <%= button_tag t("cms.syntax_check"), { type: :button, class: "btn syntax-check" } %>
    <% end %>
    <% if source_cleaner_conf[:source_cleaner].present? %>
      <%= button_tag t("cms.source_cleaner"), { type: :button, class: "btn", id: "#{id}-source-cleaner" } %>
    <% end %>
  </div>

  <%= jquery do %>
    <% if source_cleaner_conf[:source_cleaner].present? %>
      if (!Cms_Source_Cleaner.config) {
        Cms_Source_Cleaner.config = <%= raw source_cleaner_conf.to_json %>
      }
      Cms_Source_Cleaner.render(<%== "##{id}-source-cleaner".to_json %>, <%== { editor: editor_id }.to_json %>);
    <% end %>

    <% if @inplace_syntax_check %>
      Cms_Inplace_Form.resolveType = "html";
      Cms_Inplace_Form.getContent = function () {
        return Cms_Form.getEditorHtml("<%= editor_id %>");
      };
      Cms_Inplace_Form.setContent = function (content) {
        Cms_Form.setEditorHtml(content, { id: "<%= editor_id %>" });
      };
    <% end %>
  <% end %>
<% end %>
