<%= jquery do %>
  $(".mod-cms-additional-info").on('click', '.add-info', function () {
    if ($(".mod-cms-additional-info").length < 10) {
      var template = $('script#mod-cms-additional-info-template').text();
      $(".mod-cms-additional-info .add-info").before(template);
    }
    return false;
  });
  $(".mod-cms-additional-info").on('click', '.clear', function () {
    var dd = $(this).closest("dd");
    var dt = dd.prev("dt");
    if ($(".mod-cms-additional-info dt").length > 2) {
      if (dt.find("input").val() !== "" || dd.find("textarea").val() !== "") {
        if (confirm('<%= t("cms.confirm.delete_item") %>')) {
          dt.remove();
          dd.remove();
        }
      } else {
        dt.remove();
        dd.remove();
      }
    } else {
      if (dt.find("input").val() !== "" || dd.find("textarea").val() !== "") {
        if (confirm('<%= t("cms.confirm.delete_item") %>')) {
          dt.find("input").val("");
          dd.find("textarea").val("");
        }
      } else {
        dt.find("input").val("");
        dd.find("textarea").val("");
      }
      return false;
    }
  });
<% end %>

<% render_inputs = proc do |info| %>
  <dt><%= text_field_tag "item[additional_info][][field]", info ? info[:field] : nil %></dt>
  <dd>
    <%= text_area_tag "item[additional_info][][value]", info ? info[:value] : nil %>
    <%= button_tag @item.t(:del_info), {type: :button, class: "clear btn"} %>
  </dd>
<% end %>

<dl class="see mod-cms-additional-info">
  <dt class="field"><%= @item.t :field %><%= @item.tt :field %></dt>
  <dd class="value"><%= @item.t :value %><%= @item.tt :value %></dd>

  <% if @item.additional_info.blank? %>
    <% render_inputs.call %>
  <% end %>

  <% @item.additional_info.each do |info| %>
    <% render_inputs.call(info) %>
  <% end %>

  <%= button_tag @item.t(:add_info), {type: :button, class: "add-info btn"} %>
</dl>

<script id="mod-cms-additional-info-template" type="text/html">
  <% render_inputs.call %>
</script>
