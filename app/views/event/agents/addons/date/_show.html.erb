<%
  return "" if @item.event_dates.blank?

  week_days = I18n.t("date.abbr_day_names")
%>

<% render_recurr = proc do |recurr| %>
  <div class="event-recurrence">
    <div class="event-recurrence-row">
      <div class="event-recurrence-date">
        <%= recurr.start_date.try { |time| I18n.l(time.to_date, format: :picker) } %>
        <%= t("ss.wave_dash") %>
        <%= recurr.until_on.try { |time| I18n.l(time.to_date, format: :picker) } %>
      </div>
      <% if recurr.kind == "datetime" %>
        <div class="event-recurrence-time">
          <%= recurr.start_datetime.try { |time| I18n.l(time, format: :zoo_hh_mm) } %>
          <%= t("ss.wave_dash") %>
          <%= recurr.end_at.try { |time| I18n.l(time, format: :zoo_hh_mm) } %>
        </div>
      <% end %>
      <% if recurr.exclude_dates.present? %>
        <div class="event-recurrence-excludes">(除外日:
          <%= recurr.exclude_dates.try { |dates| dates.map { |date| I18n.l(date.to_date, format: :picker) }.join(",") } %>)
        </div>
      <% end %>
      <% if recurr.frequency == "weekly" && recurr.by_days.present? %>
        <div class="event-recurrence-wdays">
          <%= recurr.by_days.map { |by_day| week_days[by_day] }.join(",") %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<dl class="see mod-event">
  <dt><%= @model.t :event_name %></dt>
  <dd class="event-name"><%= @item.send :event_name %></dd>

  <dt><%= @model.t :event_recurrences %></dt>
  <dd class="event-daily-recurrences">  <dd></dd>
  <dt class="depth-2"><%= t("event.daily_event") %></dt>
  <dd class="depth-2">
    <% @item.event_recurrences.each do |recurr| %>
      <% next if recurr.frequency != "daily" %>
      <% render_recurr.call(recurr) %>
    <% end %>
  </dd>

  <dt class="depth-2"><%= t("event.weekly_event") %></dt>
  <dd class="depth-2">
    <% @item.event_recurrences.each do |recurr| %>
      <% next if recurr.frequency != "weekly" %>
      <% render_recurr.call(recurr) %>
    <% end %>
  </dd>

  <dt><%= @model.t :event_deadline %></dt>
  <dd><%= tryb { I18n.l(@item.event_deadline) } %></dd>
</dl>
