<link href="/assets/css/colorbox/colorbox.css" media="all" rel="stylesheet" />
<script src="/assets/js/jquery.colorbox.js"></script>
<%= coffee do %>
$ ->
  # show point
  $.ajax
    url: "<%= @cur_page.point_url %>"
    success: (data)->
      $(".point").html data

  # hide categories
  $(".categories a[data-class=other]").click ->
    type = $(this).attr("class")
    $(".categories a." + type).show()
    $(this).remove()
    return false

  # preview
  $("a.content").colorbox({ fixed: true, width: "90%", height: "90%" })

<% end %>

<header>
  <h1 class="name"><%= @cur_page.send :name %></h1>
</header>

<div class="point">
  <div class="count">
    <span class="number"><%= @cur_page.point %></span>
    <span class="label">いいね！数</span>
  </div>
</div>

<%
max = 3
categories = [
  { items: @cur_page.categories, type: :category, name: :name, key: :category_id, val: :id },
  { items: @cur_page.areas.sort(order: 1), type: :area, name: :name, key: :area_id, val: :id },
  { items: @cur_page.tags, type: :tag, name: :to_s, key: :tag, val: :to_s },
]
%>
<nav class="categories">
  <% categories.each do |cate| %>
    <% cate[:items].each_with_index do |item, idx| %>
      <% hide = (idx >= max) ? "display: none" : nil %>
      <%= link_to item.send(cate[:name]), "#{@search_url}?s[#{cate[:key]}]=#{item.send(cate[:val])}",
        class: cate[:type], style: hide %>
    <% end %>
    <% if cate[:items].size > max %>
      <%= link_to "他#{cate[:items].size-max}件", "#",
        class: "#{cate[:type]}", "data-class" => "other" %>
    <% end %>
  <% end %>
</nav>

<div class="detail">

  <div class="info-wrap">
    <div class="idea-comments">

      <div class="text">
        <%= auto_link br(@cur_page.text) %>
        <hr>
      </div>

      <% if true %>
      <div class="input_comment">
        <%= form_for :s, url: "", html: { class: "opendata-search_ideas-form", method: :get } do |f| %>
          <dl class="comment_body">
            <dt><%= @cur_page.t :comment_body %></dt>
            <dd><%= f.text_field :comment_body %></dd>
          </dl>
          <%= link_to "このページにコメントする", "#", class: "update #{@mode}" %>
        <% end %>
      </div>
      <% end %>

  </div>
</div>

