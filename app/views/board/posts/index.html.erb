<%= jquery do %>
SS_TreeUI.render(".index.topics");
<% end %>

<div class="table-responsive">
  <table class="index topics table table-striped">
    <thead>
      <tr>
        <th><%= @model.t :name %></th>
        <th class="datetime"><%= @model.t :updated %></th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <% @items.each do |topic| %>
        <tr data-depth="1">
          <td class="expandable">
            <%= link_to topic.name, action: :show, id: topic %>
          </td>
          <td><%= topic.updated.strftime("%Y/%m/%d %H:%M") %></td>
          <td><%= link_to t('ss.links.reply'), { action: :new_reply, id: topic }, class: "btn btn-outline-secondary btn-sm mb-0" %></td>
          <td>
            <div class="dropdown">
              <button class="btn bmd-btn-icon dropdown-toggle" type="button" data-toggle="dropdown"
               aria-haspopup="true" aria-expanded="false">
                <i class="material-icons">more_vert</i>
              </button>
              <div class="dropdown-menu  dropdown-menu-left">
                <%= link_to t('ss.links.show'), { action: :show, id: topic }, class: "dropdown-item" %>
                <%= link_to t('ss.links.edit'), action: :edit, id: topic if topic.allowed?(:edit, @cur_user, site: @cur_site) %>
                <%= link_to t('ss.links.reply'), action: :new_reply, id: topic if topic.allowed?(:edit, @cur_user, site: @cur_site) %>
                <%= link_to t('ss.links.delete'), action: :delete, id: topic if topic.allowed?(:delete, @cur_user, site: @cur_site) %>
                <%= link_to t('ss.links.view_site'), @cur_node.full_url, target: :_blank if @cur_node.public? %>
                <%= link_to t('ss.links.pc_preview'), cms_preview_path(path: @cur_node.preview_path), target: :_blank, class: "dropdown-item" %>
              </div>
            </div>
          </td>
        </tr>
        <% topic.children.order(descendants_updated: -1).each do |comment| %>
          <tr data-depth="2">
            <td class="expandable">
              <%= link_to comment.name, action: :show, id: comment %>
            </td>
            <td><%= comment.updated.strftime("%Y/%m/%d %H:%M") %></td>
            <td></td>
            <td>
              <button class="btn bmd-btn-icon dropdown-toggle" type="button" data-toggle="dropdown"
               aria-haspopup="true" aria-expanded="false">
                <i class="material-icons">more_vert</i></button>
              <div class="dropdown-menu  dropdown-menu-left">
                <%= link_to t('ss.links.show'), action: :show, id: comment %>
                <%= link_to t('ss.links.edit'), action: :edit, id: comment if comment.allowed?(:edit, @cur_user, site: @cur_site) %>
                <%= link_to t('ss.links.delete'), action: :delete, id: comment if comment.allowed?(:delete, @cur_user, site: @cur_site) %>
                <%= link_to t('ss.links.view_site'), @cur_node.full_url, target: :_blank if @cur_node.public? %>
                <%= link_to t('ss.links.pc_preview'), cms_preview_path(path: @cur_node.preview_path), target: :_blank %>
              </div>
            </td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
</div>

<%= paginate @items if @items.try(:current_page) %>
