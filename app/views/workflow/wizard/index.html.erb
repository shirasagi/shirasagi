<%
  mode = (@ss_mode == :gws) ? "g" : "s"
  request_approver_setting_url = "/.#{mode}#{@cur_site.id}/workflow#{@cur_node.try(:id)}/wizard/#{params[:id]}/approver_setting"
%>

<%= coffee do %>
$ ->

  $(".workflow-route-start").on "click", (e) ->
    route_id = $("#workflow_route").val()
    $.ajax
      type: "post"
      url: "<%= request_approver_setting_url %>"
      async: false
      data:
        route_id: route_id
      success: (html, status) ->
        $(".workflow-partial-section").html(html)
      error: (xhr, status) ->
        try
          errors = $.parseJSON(xhr.responseText)
          alert(errors.join("\n"));
        catch
          alert(["== Error =="].concat(xhr["statusText"]).join("\n"));
    e.preventDefault()

<% end %>

<dl class="see">
  <dt><%= t("workflow.request") %><%= @model.tt :workflow_routes %></dt>
  <dd>
    <%= select_tag :workflow_route, options_for_select(Workflow::Route.route_options(@cur_user)) %>
    <%= link_to t("workflow.button.select"), "#", class: "workflow-route-start cboxElement btn" %>
  </dd>
</dl>
