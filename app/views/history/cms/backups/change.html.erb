<div class="main-box">
  <table class="see index history-backup">
    <tr>
      <th></th>
      <th><%= I18n.t('history.before_state') %></th>
      <th><%= I18n.t('history.current_state') %></th>
    </tr>
    <% @item.data.sort.each do |k, v| %>
    <% next if @data[k] == v %>
    <tr>
      <th><%= @item.ref_class.constantize.t k %></th>
      <% case v %>
      <% when Array %>
        <% before_value = v.present? ? v.join(',') : "" %>
        <% current_value = @data[k].present? ? @data[k].join(',') : "" %>
        <td><%= before_value %></td>
        <td><%= current_value %></td>
      <% when String %>
        <% before_value = v.present? ? v : "" %>
        <% current_value = @data[k].present? ? @data[k] : "" %>
        <td><%= diff_before_value(before_value, current_value) %></td>
        <td><%= diff_current_value(current_value, before_value) %></td>
      <% else %>
        <% before_value = v.present? ? v.inspect : "" %>
        <% current_value = @data[k].present? ? @data[k].inspect : "" %>
        <td><%= before_value %></td>
        <td><%= current_value %></td>
      <% end %>
    </tr>
    <% end %>
  </table>
</div>
