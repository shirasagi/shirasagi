<%

model = Gws::Schedule::RepeatPlan
@item.sync_repeat_plan if params[:action] =~ /(new|edit)/

%>
<%= jquery do %>
  Gws_Schedule_Repeat_Plan.renderForm();
  <% if @item.repeat_plan.present? %> Gws_Schedule_Repeat_Plan.renderSubmitButtons(); <% end %>
<% end %>

<dl class="see">
  <dt><%= model.t :repeat_type %><%= model.tt :repeat_type %></dt>
  <dd><%= f.select :repeat_type, @item.repeat_type_options, include_blank: t("gws/schedule.options.repeat_type.none") %></dd>
</dl>

<dl class="see gws-schedule-repeat hide">
  <dt><%= model.t :interval %><%= model.tt :interval %></dt>
  <dd>
    <%= f.select :interval, @item.interval_options %>
    <span class="repeat-daily"><%= t "gws/schedule.options.interval.daily" %></span>
    <span class="repeat-weekly"><%= t "gws/schedule.options.interval.weekly" %></span>
    <span class="repeat-monthly"><%= t "gws/schedule.options.interval.monthly" %></span>
  </dd>

  <dt class="repeat-monthly"><%= model.t :repeat_base %><%= model.tt :repeat_base %></dt>
  <dd class="repeat-monthly">
    <div class="<%= 'checks_with_errors' if @item.errors[:repeat_base].size > 0 %>">
      <label><%= f.radio_button :repeat_base, "date" %> <%= t "gws/schedule.options.repeat_base.date" %></label>
      <label><%= f.radio_button :repeat_base, "wday" %> <%= t "gws/schedule.options.repeat_base.wday" %></label>
    </div>
  </dd>

  <dt class="repeat-weekly"><%= model.t :wdays %><%= model.tt :wdays %></dt>
  <dd class="repeat-weekly">
    <div class="<%= 'checks_with_errors' if @item.errors[:wdays].size > 0 %>">
      <%= f.hidden_field "wdays[]", value: "" %>
      <% (0..6).each do |i| %>
      <label><%= f.check_box "wdays[]", {}, i.to_s %> <%= t("date.abbr_day_names")[i] %></label>
      <% end %>
    </div>
  </dd>

  <dt><%= model.t :repeat_start %><%= model.tt :repeat_start %></dt>
  <dd><%= f.text_field :repeat_start, class: "date repeat_start", value: tryb{@item.repeat_start.strftime("%Y/%m/%d")} %></dd>

  <dt><%= model.t :repeat_end %><%= model.tt :repeat_end %></dt>
  <dd><%= f.text_field :repeat_end, class: "date repeat_end", value: tryb{@item.repeat_end.strftime("%Y/%m/%d")} %></dd>
</dl>
