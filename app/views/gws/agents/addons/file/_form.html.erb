<% return if @file_addon_state == 'hide' %>

<%= jquery do %>
window.insertContent = function(cont) {
  if ((typeof tinymce) != "undefined") {
    tinymce.get(Cms_Form.editorId).execCommand("mceInsertContent", false, cont);
  }
  else if (typeof CKEDITOR != "undefined") {
    CKEDITOR.instances[Cms_Form.editorId].insertHtml(cont);
  }
};
window.deleteContent = function(id) {
  $(".file-view").each(function() {
    //if (id == $(this).find("input[type=checkbox]").attr("value")) {
    //  $(this).remove();
    //}
    if (id == $(this).find(".file-id").attr("value")) {
      $(this).remove();
    }
  });
};
SS_Addon_TempFile.renderDrop($(".upload-drop-area"), <%= @cur_user.id %>);
<% end %>

<div class="see gws-addon-file">
  <div class="upload-drop-area col-12 mb-3 pt-3 pb-3">
    <div class="col12 mb-3 d-flex justify-content-between">
      <%= f.hidden_field "file_ids[]", value: "" %>
      <div class="upload-menu-new">
        <%= link_to t('ss.links.upload'), sns_apis_temp_files_path(@cur_user), class: "ajax-box btn btn-outline-secondary" %>
      </div>
      <div class="upload-menu-select">
        <%= link_to t("sns.user_file"), sns_apis_user_files_path(@cur_user), class: "ajax-box btn btn-outline-secondary" %>
        <%= link_to t("modules.gws/share"), gws_apis_files_path, class: "ajax-box btn btn-outline-secondary" %>
      </div>
    </div>
    <p class="upload-drop-notice"><%= t('ss.notice.file_droppable') %></p>
  </div>

  <div id="selected-files" class="card-columns mb-3">
    <% @item.files.each do |file| %>
      <div id="file-<%= file.id %>" class="file-view card">

        <%= link_to file.url, class: "thumb card-img-top", target: "_blank" do %>
          <% if file.image? %>
            <%= image_tag file.thumb_url, alt: file.name %>
          <% else %>
            <span class="ext icon-<%= file.extname %>"><%= file.extname %></span>
          <% end %>
        <% end %>

        <div class="name card-body">
          <label>
            <input type="hidden" name="item[file_ids][]" value="<%= file.id %>" class="file-id" />
            <%= file.name %>
          </label>
          <div class="action">
            <%= link_to t("ss.buttons.delete"), "#", :onclick => "deleteContent('#{file.id}'); return false;", class: "btn btn-secondary" %>
          </div>
        </div>
      </div>
    <% end %>

    <% @item.ref_files.each do |file| %>
      <div id="file-<%= file.id %>" class="file-view card">

        <%= link_to file.url, class: "thumb card-img-top", target: "_blank" do %>
          <% if file.image? %>
            <%= image_tag file.thumb_url, alt: file.name %>
          <% else %>
            <span class="ext icon-<%= file.extname %>"><%= file.extname %></span>
          <% end %>
        <% end %>

        <div class="name card-body">
          <label>
            <input type="hidden" name="item[ref_file_ids][]" value="<%= file.id %>" class="file-id" />
            <%= file.name %>
          </label>
          <div class="action">
            <!-- attach and paste not supported -->
            <%= link_to t("ss.buttons.delete"), "#", :onclick => "deleteContent('#{file.id}'); return false;", class: "btn btn-secondary" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
