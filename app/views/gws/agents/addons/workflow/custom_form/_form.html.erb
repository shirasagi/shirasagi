<% return if @cur_form.blank? && (@item.cur_form || @item.form).blank? %>
<% @cur_form ||= (@item.cur_form || @item.form) %>

<dl class="see mod-gws-workflow-custom_form">
  <% @cur_form.columns.order_by(order: 1, created: 1).each do |column| %>
    <%= render(file: "app/views/gws/facility/custom_fields/input_forms/_#{column.input_type}", locals: { item: column, object_name: 'custom', value: @item.read_custom_value(column) }) %>
  <% end %>
</dl>

<%= jquery do %>
  $('#addon-ss-agents-addons-markdown').hide();
  $('#addon-gws-agents-addons-file').hide();
  $('#addon-gws-agents-addons-workflow-custom_form .addon-head h2').text(<%== @cur_form.name.to_json %>);

  var columnId;

  $('a.btn-file-upload').on('click', function(e) {
    columnId = $(this).data('column-id');
  });

  $('a.btn-file-upload').data('on-success', function(html) {
    // console.log('on success: ' + columnId);
    $.colorbox.close();

    console.log(html);

    if (! columnId) {
      return;
    }

    var fileId = $(html).data('file-id');
    var humanizedName = $(html).data('humanized-name');
    if (! fileId || ! humanizedName) {
      return;
    }

    $('input[name="custom[' + columnId + ']"]').val(fileId);
    $('span.humanized-name.column-' + columnId).text(humanizedName);
  });
<% end %>
