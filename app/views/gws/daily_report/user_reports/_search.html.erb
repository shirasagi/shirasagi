<%= jquery do %>
  (function ($) {
    $('.gws-schedule-box header .operations .btn-csv').on('click', function() {
      location.href = '<%= @download_url %>';
    });

    $('.gws-schedule-box header .operations .btn-print').on('click', function() {
      var viewName = $('#calendar').fullCalendar('getView').name;
      var curDate = $('#calendar').fullCalendar('getDate');
      if (!viewName) {
        viewName = $('#calendar-controller').fullCalendar('getView').name;
        curDate = $('#calendar-controller').fullCalendar('getDate');
      }

      var viewFormat = "default";
      if ($('#calendar').find('.fc-withListView-button').hasClass("fc-state-active")) {
        viewFormat = "list";
      }

      var viewTodo = "inactive";
      if ($('#calendar').find('.fc-withTodo-button').hasClass("fc-state-active")) {
        viewTodo = "active";
      }

      var viewAttendance = "inactive";
      if ($('#calendar').find('.fc-withAbsence-button').hasClass("fc-state-active")) {
        viewAttendance = "active";
      }

      var queryString = '';
      if (viewName) {
        var queryParams = <%== request.query_parameters.to_json %>;
        if (! queryParams.calendar) {
          queryParams.calendar = {};
        }
        queryParams.calendar.view = viewName;
        queryParams.calendar.date = curDate.format();
        queryParams.calendar.viewFormat = viewFormat;
        queryParams.calendar.viewTodo = viewTodo;
        queryParams.calendar.viewAttendance = viewAttendance;
        queryString = '?' + $.param(queryParams);
      }
      var path = '<%= url_for({ action: :print }) %>' + queryString;
      location.href = path;
    });
  })($jQuery1);
<% end %>

<div class="operations">
  <%= ss_button_to t("ss.buttons.csv"), url_for(action: :download), model: @model, class: "btn btn-download btn-list-head-action", method: "get", confirm: t("ss.confirm.download") %>
  <%= ss_button_to t('ss.buttons.print'), url_for(action: :print), model: @model, class: "btn btn-print btn-list-head-action", method: "get" %>
</div>

<% @s = OpenStruct.new params[:s] %>
<%= form_for :s, url: "", html: { method: :get, class: :search } do |f| %>
  <%= f.text_field :keyword, style: "width: 140px;" %>
  <input type="submit" value="<%= t('ss.buttons.search') %>" class="btn" />
<% end %>
