<%= jquery do %>
    Gws_Monitor_Topic.render();

    switch ("<%= @item[:state_of_the_answers_hash]["#{@cur_group.id}"] %>"){
      case "public":
        $('.public').hide();
        $('.preparation').show();
        $('.primary').show();
        break;
      case "answered":
        $('.public').show();
        $('.preparation').show();
        $('.primary').show();
        break;
      case "preparation":
        $('.public').show();
        $('.preparation').hide();
        $('.primary').hide();
        break;
      case "question_not_applicable":
        $('.public').show();
        $('.preparation').hide();
        $('.primary').show();
        break;
    }
<% end %>

<div class="gws-board gws-board-thread">
  <article class="topic" id="post-<%= @item.id %>">
    <header>
      <h2>
        <span class="name"><%= @item.name %></span>
        <span class="categories">
          <% @item.categories.each do |category| %>
            <%= link_to category.trailing_name, gws_monitor_category_topics_path(category: category.id),
                        class: "gws-category-label", style: category_label_css(category) %>
          <% end %>
        </span>
      </h2>
      <nav class="meta">
        <span class="user"><%= @item.contributor_name.presence || @item.user_long_name %></span>
        <span class="datetime"><%= @item.updated.strftime("%Y/%m/%d %H:%M") %></span>
      </nav>
    </header>

    <div class="body markdown-body">
      <%= @item.html %>
    </div>

    <% if @item.files.present? %>
    <div class="files">
      <% @item.files.each do |file| %>
        <span id="file-<%= file.id %>">
          <img src="/assets/img/gws/ic-file.png" alt="" />
          <%= link_to file.humanized_name, file.url, class: "icon-#{file.extname}", target: '_blank' %>
        </span>
      <% end %>
    </div>
    <% end %>

    <% if @item.severity.present? %>
    <div class="status">
      <span class="severity">
        <label><%= @model.t(:severity) %></label>: <%= @item.label(:severity) %>
      </span>
    </div>
    <% end %>

    <% if @item.permit_comment? && @model.allowed?(:edit, @cur_user, site: @cur_site) && !@item.closed? && @item.attend_group_ids.include?(@cur_group.id) %>
    <div class="menu">
      <%= hidden_field_tag "item_id", @item.id %>
      <% if @item.comment(@cur_group.id).blank? %>
      <button class="public btn"><%= t 'gws/monitor.links.public' %></button>
      <button class="preparation btn"><%= t 'gws/monitor.links.preparation' %></button>
        <% if params[:controller] == "gws/monitor/topics" %>
          <%= link_to(t('gws/monitor.links.comment'), @category.present? ? new_gws_monitor_category_topic_parent_comment_path(topic_id: @item.id, parent_id: @item.id) : new_gws_monitor_topic_parent_comment_path(topic_id: @item.id, parent_id: @item.id),
          class: "btn primary") %>
        <% elsif params[:controller] == "gws/monitor/answers" %>
          <%= link_to(t('gws/monitor.links.comment'), @category.present? ? new_gws_monitor_category_answer_parent_comment_path(answer_id: @item.id, parent_id: @item.id) : new_gws_monitor_answer_parent_comment_path(answer_id: @item.id, parent_id: @item.id),
          class: "btn primary") %>
        <% elsif params[:controller] == "gws/monitor/admins" %>
          <%= link_to(t('gws/monitor.links.comment'), @category.present? ? new_gws_monitor_category_admin_parent_comment_path(admin_id: @item.id, parent_id: @item.id) : new_gws_monitor_admin_parent_comment_path(admin_id: @item.id, parent_id: @item.id),
          class: "btn primary") %>
        <% end %>
      <% else %>
        <% if params[:controller] == "gws/monitor/topics" %>
          <%= link_to(t('gws/monitor.links.reply'), @category.present? ? new_gws_monitor_category_topic_parent_comment_path(topic_id: @item.id, parent_id: @item.id) : new_gws_monitor_topic_parent_comment_path(topic_id: @item.id, parent_id: @item.id),
          class: "btn primary") %>
        <% elsif params[:controller] == "gws/monitor/answers" %>
          <%= link_to(t('gws/monitor.links.reply'), @category.present? ? new_gws_monitor_category_answer_parent_comment_path(answer_id: @item.id, parent_id: @item.id) : new_gws_monitor_answer_parent_comment_path(answer_id: @item.id, parent_id: @item.id),
          class: "btn primary") %>
        <% elsif params[:controller] == "gws/monitor/admins" %>
          <%= link_to(t('gws/monitor.links.reply'), @category.present? ? new_gws_monitor_category_admin_parent_comment_path(admin_id: @item.id, parent_id: @item.id) : new_gws_monitor_admin_parent_comment_path(admin_id: @item.id, parent_id: @item.id),
          class: "btn primary") %>
        <% end %>
      <% end %>
    </div>
    <% end %>
  </article>

  <% if @item.children.present? %>
  <div class="comments">
    <%= render partial: 'gws/monitor/comments/comment', collection: @item.descendants, locals: { parent: @item, recursion: false } %>
  </div>
  <% end %>

  <% if params[:controller] =~ /admin/ || @item.attend_group_ids.include?(@cur_group.id) || @item.spec_config != '0'%>
    <%= render partial: 'gws/monitor/main/subscribed_groups' %>
  <% end %>
</div>

<%= jquery do %>
  var highlighter = new Gws_Elasticsearch_Highlighter();
  highlighter.render();
<% end %>
