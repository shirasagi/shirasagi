<% if @cur_node.upper_html.present? %>
<%
  html = @cur_node.upper_html.gsub(/\#\{(.*?)\}/) do |m|
    name = $1
    if name =~ /keyword/
      html_escape(@keyword.to_s)
    elsif name =~ /category/
      html_escape(@categories.pluck(:name).join("、"))
    elsif name =~ /service/
      html_escape(@services.pluck(:name).join("、"))
    elsif name =~ /location/
      html_escape(@locations.pluck(:name).join("、"))
    elsif name =~ /number/
      html_escape(@items.count.to_s)
    else
      m
    end
  end
  html = html.gsub(/\#\{(.*?)\}/) do |m|
    if $1 =~ /(tabs|settings)/
      render template: "_#{$1}"
    else
      m
    end
  end
%>
<%= html.html_safe %>
<% else %>
<dl class="condition">
  <dt class="keyword"><%= t("facility.keyword") %></dt>
  <dd><%= @keyword %></dd>
  <dt class="category"><%= t("facility.category.name") %></dt>
  <dd><%= @categories.pluck(:name).join("、") %></dd>
  <dt class="service"><%= t("facility.service.name") %></dt>
  <dd><%= @services.pluck(:name).join("、") %></dd>
  <dt class="location"><%= t("facility.location.name") %></dt>
  <dd><%= @locations.pluck(:name).join("、") %></dd>
</dl>
<%= render template: "_settings" %>
<section class="result">
  <h2>
    <%= t("facility.result") %>
    <span class="number"><%= @items.count %></span><%= t("facility.count") %>
  </h2>
</section>
<%= render template: "_tabs" %>
<% end %>
