this.SS_TreeUI = (function () {
  SS_TreeUI.openImagePath = "/assets/img/tree-open.png";

  SS_TreeUI.closeImagePath = "/assets/img/tree-close.png";

  SS_TreeUI.render = function (tree, opts) {
    return new SS_TreeUI(tree, opts);
  };

  SS_TreeUI.toggleImage = function (img) {
    if (img.attr("src") === SS_TreeUI.openImagePath) {
      return SS_TreeUI.closeImage(img);
    } else if (img.attr("src") === SS_TreeUI.closeImagePath) {
      return SS_TreeUI.openImage(img);
    }
  };

  SS_TreeUI.openImage = function (img) {
    img.attr("src", SS_TreeUI.openImagePath);
    img.addClass("opened");
    return img.removeClass("closed");
  };

  SS_TreeUI.closeImage = function (img) {
    img.attr("src", SS_TreeUI.closeImagePath);
    img.removeClass("opened");
    return img.addClass("closed");
  };

  function SS_TreeUI(tree, opts) {
    if (opts == null) {
      opts = {}
    }

    var root;
    var expand_all = null;
    this.tree = $(tree);

    root = [];
    expand_all = opts["expand_all"];

    this.tree.find("tbody tr").each(function () {
      return root.push(parseInt($(this).attr("data-depth")));
    });
    root = Math.min.apply(null, root);
    root = parseInt(root);
    if (isNaN(root) || root < 0) {
      return;
    }
    this.tree.find("tbody tr").each(function () {
      var d, depth, i, j, ref, ref1, td;
      td = $(this).find(".expandable");
      depth = parseInt($(this).attr("data-depth"));
      td.prepend('<img src="' + SS_TreeUI.closeImagePath + '" alt="toggle" class="toggle closed">');
      if (depth !== root) {
        if (!expand_all) {
          $(this).hide();
        }
      }
      for (i = j = ref = root, ref1 = depth; ref <= ref1 ? j < ref1 : j > ref1; i = ref <= ref1 ? ++j : --j) {
        td.prepend('<span class="padding">');
      }
      d = parseInt($(this).next("tr").attr("data-depth")) || 0;
      i = $(this).find(".toggle:first");
      if (d === 0 || depth >= d) {
        return i.replaceWith('<span class="padding">');
      }
    });
    this.tree.find(".toggle").on("mousedown mouseup", function (e) {
      e.stopPropagation();
      return false;
    });
    this.tree.find(".toggle").on("click", function (e) {
      var depth, img, tr;
      tr = $(this).closest("tr");
      img = tr.find(".toggle:first");
      depth = parseInt(tr.attr("data-depth"));
      SS_TreeUI.toggleImage(img);
      tr.nextAll("tr").each(function () {
        var d, i;
        d = parseInt($(this).attr("data-depth"));
        i = $(this).find(".toggle:first");
        if (depth >= d) {
          return false;
        }
        if ((depth + 1) === d) {
          $(this).toggle();
          return SS_TreeUI.closeImage(i);
        } else {
          $(this).hide();
          return SS_TreeUI.closeImage(i);
        }
      });
      e.stopPropagation();
      return false;
    });
    if (!expand_all) {
      this.tree.find("tr[data-depth='" + root + "'] img").click();
    }
    else {
      SS_TreeUI.openImage(this.tree.find("tbody tr img"));
    }
  }

  SS_TreeUI.prototype.expandAll = function () {
    return this.tree.find("tr img.toggle.closed").click();
  };

  SS_TreeUI.prototype.collapseAll = function () {
    return $(this.tree.find("tr img.toggle.opened").get().reverse()).each(function () {
      return $(this).click();
    });
  };

  return SS_TreeUI;

})();

// ---
// generated by coffee-script 1.9.2