Cms_Column_Youtube = function (el) {
  this.$el = $(el);
};

Cms_Column_Youtube.render = function (el) {
  var instance = new Cms_Column_Youtube(el);
  instance.render();
  Cms_Column_Youtube.initialized = true;
  return instance;
};

Cms_Column_Youtube.prototype.render = function () {
  this.$el.on("click", ".youtube-title-check", function() {
    console.log("youtube-title-check_render_column_youtube");
    var $block = $(this).closest('.column-youtube-title');
    var $urlField = $block.parent().find('input[name*="[in_wrap][url]"]');
    var url = $urlField.val();
    if (!url) {
      alert("<%= (I18n.t('cms.errors.input_youtube_url')) %>");
      return;
    }
    var $titleField = $block.find('input[name*="[in_wrap][title]"]');
    var apiPath = $block.data('youtube-title-path');
    $.get(apiPath, { url: url })
      .done(function(data) {
        if (data.title) {
          $titleField.val(data.title);
        } else {
          alert("<%= (I18n.t('cms.errors.youtube_title_fetch_failed')) %>" + (data.error ? ': ' + data.error : ''));
        }
      })
      .fail(function(xhr) {
        alert("<%= (I18n.t('cms.errors.network_error')) %>");
      });
  });
};
