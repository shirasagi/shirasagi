# アクセシビリティエラー検出改善に関する工数見積もり資料

## 1. 現状の課題

### 1.1 プルリクエスト #5660 の内容
- **修正内容**: 下書き保存時にアクセシビリティエラーがあっても保存できるように修正
- **対象ファイル**: 
  - `app/assets/javascripts/cms/lib/form_alert.js.erb`
  - `spec/features/article/pages/close_permission_spec.rb`
  - `spec/features/article/pages/ignore_alert_spec.rb`

### 1.2 現在のアクセシビリティエラー検出システムの限界

#### 検出可能なエラー
現在のシステムでは以下のエラーのみ検出可能：

1. **画像関連**
   - `img`タグの`alt`属性未設定
   - `area`タグの`alt`属性未設定
   - 画像ファイル名にalt属性が含まれている場合

2. **リンク関連**
   - リンクテキストが3文字以下の場合
   - 隣接する`a`タグの区切り文字不足

3. **見出し構造**
   - 見出し（H1-H6）の順序が不正

4. **テーブル関連**
   - テーブルの構造チェック

5. **その他**
   - 埋め込みメディア（動画・音声）の説明不足
   - 不正なURLスキーム
   - データURIスキームの使用

#### 検出できない重要なアクセシビリティエラー

1. **色とコントラスト**
   - 色のみによる情報伝達
   - コントラスト比の不足
   - 背景色と文字色の組み合わせ

2. **キーボードナビゲーション**
   - フォーカス可能要素の不足
   - フォーカス順序の問題
   - キーボードトラップ

3. **スクリーンリーダー対応**
   - `aria-*`属性の不適切な使用
   - ランドマークロールの不足
   - スキップリンクの不足

4. **フォーム関連**
   - `label`要素の不足
   - `fieldset`と`legend`の不適切な使用
   - エラー表示の関連付け不足

5. **動的コンテンツ**
   - JavaScriptによる動的更新の通知不足
   - ライブリージョンの不適切な使用

## 2. 改善に必要な作業項目

### 2.1 新規チェッカーの開発

#### Phase 1: 基本的なアクセシビリティチェッカー（4-6週間）

1. **色とコントラストチェッカー**
   - CSS解析機能の実装
   - 色の組み合わせ分析
   - WCAG 2.1 AA準拠のコントラスト比チェック
   - **工数**: 1.5週間

2. **フォームアクセシビリティチェッカー**
   - `label`要素の関連付けチェック
   - `fieldset`と`legend`の適切性チェック
   - 必須項目の明示チェック
   - **工数**: 1週間

3. **ARIA属性チェッカー**
   - `aria-*`属性の適切性チェック
   - ランドマークロールの検証
   - 重複するランドマークの検出
   - **工数**: 1.5週間

4. **キーボードナビゲーションチェッカー**
   - フォーカス可能要素の検出
   - フォーカス順序の分析
   - キーボードトラップの検出
   - **工数**: 1週間

#### Phase 2: 高度なチェッカー（6-8週間）

5. **動的コンテンツチェッカー**
   - JavaScriptによる更新の検出
   - ライブリージョンの適切性チェック
   - 状態変更の通知機能チェック
   - **工数**: 2週間

6. **レスポンシブデザインチェッカー**
   - モバイル表示でのアクセシビリティ
   - タッチターゲットサイズの検証
   - ズーム機能の確認
   - **工数**: 1.5週間

7. **マルチメディアアクセシビリティチェッカー**
   - 動画の字幕・音声解説チェック
   - 音声コンテンツの代替手段確認
   - メディアコントロールのアクセシビリティ
   - **工数**: 1.5週間

8. **国際化対応チェッカー**
   - 言語属性の適切性
   - 文字方向の確認
   - 多言語コンテンツの構造
   - **工数**: 1週間

### 2.2 既存システムの拡張

#### フロントエンド拡張（2-3週間）

1. **JavaScriptチェッカーの統合**
   - 新規チェッカーを既存の`Syntax_Checker`に統合
   - 非同期チェック機能の拡張
   - エラー表示UIの改善
   - **工数**: 1.5週間

2. **パフォーマンス最適化**
   - 大量コンテンツでの処理速度改善
   - キャッシュ機能の実装
   - プログレス表示の追加
   - **工数**: 1週間

#### バックエンド拡張（2-3週間）

3. **サーバーサイドチェッカーの実装**
   - Rubyベースのチェッカー実装
   - データベースとの連携
   - 設定管理機能の拡張
   - **工数**: 2週間

4. **API拡張**
   - 新規チェッカー用APIエンドポイント
   - バッチ処理機能
   - レポート生成機能
   - **工数**: 1週間

### 2.3 テスト・ドキュメント

#### テスト実装（3-4週間）

1. **単体テスト**
   - 各チェッカーの単体テスト
   - エッジケースのテスト
   - パフォーマンステスト
   - **工数**: 2週間

2. **統合テスト**
   - エンドツーエンドテスト
   - ブラウザ互換性テスト
   - ユーザビリティテスト
   - **工数**: 1.5週間

#### ドキュメント作成（1-2週間）

3. **技術ドキュメント**
   - API仕様書
   - 設定ガイド
   - トラブルシューティングガイド
   - **工数**: 1週間

4. **ユーザードキュメント**
   - 管理者向けマニュアル
   - エンドユーザー向けガイド
   - ベストプラクティス集
   - **工数**: 1週間

## 3. 工数見積もり

### 3.1 開発工数

| フェーズ | 作業項目 | 工数（週） | 担当者数 |
|---------|---------|-----------|---------|
| Phase 1 | 基本チェッカー開発 | 4-6週間 | 2-3名 |
| Phase 2 | 高度チェッカー開発 | 6-8週間 | 2-3名 |
| システム拡張 | フロントエンド・バックエンド | 4-6週間 | 2名 |
| テスト・ドキュメント | 包括的テスト・ドキュメント | 4-6週間 | 1-2名 |
| **合計** | | **18-26週間** | **2-3名** |

### 3.2 人月換算

- **最小工数**: 18週間 × 2名 = 9人月
- **最大工数**: 26週間 × 3名 = 19.5人月
- **推奨工数**: 22週間 × 2.5名 = 13.75人月

### 3.3 リスク要因

1. **技術的リスク**
   - 複雑なCSS解析の実装難易度
   - ブラウザ互換性の確保
   - パフォーマンス要件の達成

2. **スケジュールリスク**
   - 新技術の学習時間
   - 既存システムとの統合の複雑さ
   - テストケースの網羅性確保

3. **品質リスク**
   - 誤検知・未検知のバランス
   - ユーザビリティの確保
   - 保守性の維持

## 4. 推奨アプローチ

### 4.1 段階的実装

1. **第1段階（3-4ヶ月）**
   - 基本的なアクセシビリティチェッカー（Phase 1）
   - 既存システムとの統合
   - 基本的なテスト実装

2. **第2段階（3-4ヶ月）**
   - 高度なチェッカー（Phase 2）
   - パフォーマンス最適化
   - 包括的テスト

3. **第3段階（1-2ヶ月）**
   - ドキュメント作成
   - ユーザビリティ改善
   - 最終調整

### 4.2 リソース配分

- **開発者**: 2-3名（フルスタック開発者）
- **QAエンジニア**: 1名（テスト専門）
- **UXデザイナー**: 0.5名（UI/UX改善）
- **プロジェクトマネージャー**: 0.5名（進捗管理）

## 5. 結論

アクセシビリティエラー検出システムの包括的改善には、**約6-8ヶ月（13.75人月）**の開発期間が必要です。

この改善により、現在検出できない重要なアクセシビリティエラー（色とコントラスト、キーボードナビゲーション、ARIA属性など）を検出できるようになり、WCAG 2.1 AA準拠のウェブサイト構築を強力にサポートできます。

段階的実装により、早期に基本的な機能を提供し、その後高度な機能を追加することで、リスクを最小化しながら価値のある改善を実現できます。 
