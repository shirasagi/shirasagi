Gws_Attendance=function(t,e){this.el=t,this.$el=$(t),this.$toolbar=this.$el.find(".cell-toolbar"),this.options=e,this.now=new Date(e.now),this.render()},Gws_Attendance.prototype.render=function(){var t=this;this.$el.find("button[name=punch]").on("click",function(e){e.preventDefault(),e.stopPropagation();var o=$(this).data("action"),i=$(this).data("confirm");t.onPunchClicked(o,i)}),this.$el.find("button[name=edit]").on("click",function(e){e.preventDefault(),e.stopPropagation();var o=$(this).data("action"),i=$(this).data("confirm");t.onEditClicked(o,i)}),this.$el.find(".reason-tooltip").on("click",function(e){e.preventDefault(),e.stopPropagation(),t.hideToolbar(),t.hideTooltip(),$(this).find(".reason").show()}),this.$el.find("select[name=year_month]").on("change",function(){var e=$(this).val();e&&(location.href=t.options.indexUrl.replace(":year_month",e))}),$(document).on("click",this.el+" .time-card .time",function(e){e.preventDefault(),e.stopPropagation(),t.onClickTime($(this))}),$(document).on("click",this.el+" .time-card .memo",function(e){e.preventDefault(),e.stopPropagation(),t.onClickMemo($(this))}),$(document).on("click",function(){t.hideToolbar(),t.hideTooltip()})},Gws_Attendance.prototype.onPunchClicked=function(t,e){if(t&&(!e||confirm(e))){var o=$('meta[name="csrf-token"]').attr("content");$form=$("<form/>",{action:t,method:"post"}),$form.append($("<input/>",{name:"authenticity_token",value:o,type:"hidden"})),$("body").append($form),$form.submit()}},Gws_Attendance.prototype.onEditClicked=function(t,e){t&&(!e||confirm(e))&&($a=$("<a />",{href:t}),$a.colorbox({open:!0,width:"90%"}))},Gws_Attendance.prototype.hideToolbar=function(){this.$toolbar.hide()},Gws_Attendance.prototype.hideTooltip=function(){this.$el.find(".reason-tooltip .reason").hide()},Gws_Attendance.prototype.onClickTime=function(t){this.onClickCell(t,this.options.timeUrl)},Gws_Attendance.prototype.onClickMemo=function(t){this.onClickCell(t,this.options.memoUrl)},Gws_Attendance.prototype.setFocus=function(t){this.$el.find(".time-card .time").removeClass("focus"),this.$el.find(".time-card .memo").removeClass("focus"),t.addClass("focus")},Gws_Attendance.prototype.isCellToday=function(t){return t.closest("tr").hasClass("current")},Gws_Attendance.prototype.onClickCell=function(t,e){if(this.hideTooltip(),t.data("day")){if(this.setFocus(t),!this.options.editable&&!this.isCellToday(t))return void this.$toolbar.hide();var o=e;o=o.replace(":day",t.data("day")),o=o.replace(":type",t.data("type")),this.$toolbar.find(".edit").attr("href",o),this.options.editable||this.isCellToday(t)?this.$toolbar.find(".edit").show():this.$toolbar.find(".edit").hide();var i=t.offset();t.hasClass("top")?i.top-=this.$toolbar.outerHeight():i.top+=t.outerHeight(),this.$toolbar.show(),this.$toolbar.offset(i)}};