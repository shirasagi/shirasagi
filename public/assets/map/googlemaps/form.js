(function(){this.Map_Form=function(){function t(){}return t.maxPointForm=10,t.deleteMessage="\u30de\u30fc\u30ab\u30fc\u3092\u524a\u9664\u3057\u3066\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",t.dataID=0,t.clickIcon="//maps.google.com/mapfiles/ms/icons/blue-dot.png",t.clickMarker=null,t.setMapLoc=function(t,e,o){e=Math.ceil(e*Math.pow(10,6))/Math.pow(10,6),o=Math.ceil(o*Math.pow(10,6))/Math.pow(10,6),t.val(e.toFixed(6)+","+o.toFixed(6))},t.getMapLoc=function(t){var e;return e=t.val().split(","),new google.maps.LatLng(parseFloat(e[0]),parseFloat(e[1]))},t.validateLoc=function(t){var e,o,i;return o=t.val().split(","),e=parseFloat(o[0]),i=parseFloat(o[1]),!e||isNaN(e)?!1:!i||isNaN(i)?!1:e>=-90&&90>=e&&i>=-180&&180>=i?!0:!1},t.attachMessage=function(t){google.maps.event.addListener(Map.markers[t],"click",function(e){Map.openedInfo&&Map.openedInfo.close(),$('dd[data-id = "'+t+'"]').each(function(){var e,o,i;return o=$(this).find(".marker-name").val(),i=$(this).find(".marker-text").val(),(""!==o||""!==i)&&(e='<div class="marker-info">',""!==o&&(e+="<p>"+o+"</p>"),""!==i&&$.each(i.split(/[\r\n]+/),function(){return e+=this.match(/^https?:\/\//)?'<p><a href="'+this+'">'+this+"</a></p>":"<p>"+this+"</p>"}),Map.openedInfo=new google.maps.InfoWindow({content:e,maxWidth:260}),Map.openedInfo.open(Map.markers[t].getMap(),Map.markers[t])),!1})})},t.geocoderSearch=function(t){var e;return e=new google.maps.Geocoder,e.geocode({address:t,region:"jp"},function(t,e){var o;e===google.maps.GeocoderStatus.OK?(o=t[0],Map.map.setCenter(o.geometry.location),o.geometry.viewport&&Map.map.fitBounds(o.geometry.viewport)):alert("\u5ea7\u6a19\u3092\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002")}),!1},t.clonePointForm=function(){var e;$(".mod-map dd.marker").length<t.maxPointForm&&(e=$(".mod-map dd.marker:last").clone(!1).insertAfter($(".mod-map dd.marker:last")),e.attr("data-id",t.dataID),t.dataID+=1,e.find("input,textarea").val(""),e.find(".marker-name").val(""),e.find(".clear-marker").on("click",function(){return t.clearPointForm(e)}),e.find(".set-marker").on("click",function(){return t.createMarker(e)}),e.find(".marker-name").on("keypress",function(t){return 13===t.which?!1:void 0}),e.find(".marker-loc-input").on("keypress",function(t){return 13===t.which?($(this).closest("dd.marker").find(".set-marker").trigger("click"),!1):void 0}),e.find(".marker-loc-input").on("focus",function(e){return null!==t.clickMarker?(t.clickMarker.setMap(null),$(".mod-map .clicked").val("")):void 0})),$(".mod-map dd.marker").length===t.maxPointForm&&$(".mod-map dd .add-marker").parent().hide()},t.clearPointForm=function(e){""!==e.find(".marker-loc").val()?confirm(t.deleteMessage)&&(Map.markers[parseInt(e.attr("data-id"))]&&Map.markers[parseInt(e.attr("data-id"))].setMap(null),e.find("input,textarea").val(""),$(".mod-map dd.marker").length>1&&e.remove()):(Map.markers[parseInt(e.attr("data-id"))]&&Map.markers[parseInt(e.attr("data-id"))].setMap(null),e.find("input,textarea").val(""),$(".mod-map dd.marker").length>1&&e.remove()),$(".mod-map dd .add-marker").parent().show()},t.createMarker=function(e){var o,i;return i=null,""!==$(".mod-map .clicked").val()?i=$(".mod-map .clicked").val():""!==e.find(".marker-loc-input").val()&&(t.validateLoc(e.find(".marker-loc-input"))?i=e.find(".marker-loc-input").val():alert("\u6b63\u3057\u3044\u5ea7\u6a19\u3092\u30ab\u30f3\u30de(,)\u533a\u5207\u308a\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u4f8b\uff0933.8957612,133.6806607")),i?(e.find(".marker-loc").val(i),e.find(".marker-loc-input").val(i),o=parseInt(e.attr("data-id")),Map.markers[o]&&Map.markers[o].setMap(null),Map.markers[o]=new google.maps.Marker({position:t.getMapLoc(e.find(".marker-loc")),map:Map.map}),t.attachMessage(o),t.clickMarker?($(".mod-map .clicked").val(""),t.clickMarker.setMap(null)):void 0):void 0},t.renderMarkers=function(){var e,o,i,r,n,s;if(r=new google.maps.LatLngBounds,Map.markers)for(n=Map.markers,e=0,o=n.length;o>e;e++)i=n[e],i.setMap(null);Map.markers=[],t.dataID=0,$(".mod-map dd.marker").each(function(){var e;return $(this).attr("data-id",t.dataID),""!==$(this).find(".marker-loc").val()&&(e=t.getMapLoc($(this).find(".marker-loc")),Map.markers[t.dataID]=new google.maps.Marker({position:e,map:Map.map}),t.attachMessage(t.dataID),r.extend(e)),t.dataID+=1}),Map.markers.length>0&&(s=google.maps.event.addListener(Map.map,"bounds_changed",function(t){return this.getZoom()>13&&this.initialZoom===!0&&(this.setZoom(13),this.initialZoom=!1),google.maps.event.removeListener(s)}),Map.map.initialZoom=!0,Map.map.fitBounds(r))},t.renderEvents=function(){return google.maps.event.addListener(Map.map,"click",function(e){return t.setMapLoc($(".mod-map .clicked"),e.latLng.lat(),e.latLng.lng()),null!==t.clickMarker&&t.clickMarker.setMap(null),t.clickMarker=new google.maps.Marker({position:new google.maps.LatLng(e.latLng.lat(),e.latLng.lng()),icon:t.clickIcon,map:Map.map})}),$(".mod-map .add-marker").on("click",function(e){return t.clonePointForm(),!1}),$(".mod-map .clear-marker").on("click",function(e){return t.clearPointForm($(this).closest("dd.marker")),!1}),$(".mod-map .set-marker").on("click",function(e){return t.createMarker($(this).closest("dd.marker")),!1}),$(".mod-map .location-search button").on("click",function(e){return t.geocoderSearch($(".mod-map .keyword").val()),!1}),$(".mod-map .keyword").on("keypress",function(e){return 13===e.which?(t.geocoderSearch($(this).val()),!1):void 0}),$(".mod-map .marker-name").on("keypress",function(t){return 13===t.which?!1:void 0}),$(".mod-map .marker-loc-input").on("keypress",function(t){return 13===t.which?($(this).closest("dd.marker").find(".set-marker").trigger("click"),!1):void 0}),$(".mod-map .marker-loc-input").on("focus",function(e){return null!==t.clickMarker?(t.clickMarker.setMap(null),$(".mod-map .clicked").val("")):void 0})},t}()}).call(this);