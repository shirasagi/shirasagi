(function(){$(function(){var t,e,o;return Opendata.render(),o=location.pathname+"/",$("#navi .main-menu a, #navi .sub-menu a").each(function(){var t;if(t=$(this),0===o.indexOf(t.attr("href")))return t.addClass("current")}),$(window).width()>=800&&(e=$(".pulldown-menu"),t=e.find("a"),e.each(function(){return t.not(".current").hide(),t.filter(".current").prependTo(e).click(function(){return t.not(".current").slideToggle("fast"),!1})})),Opendata_Tooltips.render(),Opendata_SearchUI.render(),Opendata_ListUI.render("table.od-modal"),Opendata_HieraricalCheckbox.render()}),this.Opendata=function(){function t(){}return t.loading='<img style="vertical-align:middle" src="/assets/img/loading.gif" alt="loading.." border="0" widtth="16" height="11" />',t.render=function(t){var e;return null==t&&(t=null),t&&(e=function(){return $("#cboxLoadedContent a").each(function(){var t;if(t=$(this),t.addClass("cboxElement"),!t.attr("target")&&!t.data("target"))return t.colorbox({fixed:!0,width:"90%",height:"90%",onComplete:e})})},$(t).find("a").each(function(){var t;if(t=$(this),!t.attr("target")&&!t.data("target"))return t.colorbox({fixed:!0,width:"90%",height:"90%",onComplete:e})})),t=$(document),t.find("a[href^=http]").each(function(){return $(this).addClass("external")}),t.find(".ajax-box").each(function(){var t;return t=$(this),!!t.hasClass("cboxElement")||(t.attr("target")||t.data("target")?void 0:t.colorbox({fixed:!0,width:"90%",height:"90%"}))})},t.ajaxForm=function(t,e){var o;return null==e&&(e={}),t=$(t),o={url:t.attr("action")+".json",dataType:"json",success:function(){},error:function(t){return alert(["== Error =="].concat(t.responseJSON).join("\n"))}},t.on("submit",function(t){return $(this).ajaxSubmit($.extend(o,e)),t.preventDefault()})},t.ajax=function(e,o){return null==o&&(o={}),$(e).click(function(e){var i,n;return n=$(this),i={url:n.attr("href"),beforeSend:function(){return n.html(t.loading)},success:function(){return console.log("success")},error:function(){return alert("== Error ==")}},$.ajax($.extend(i,o)),e.preventDefault(),!1})},t.ajaxDelete=function(e,o){return null==o&&(o={}),$(e).click(function(e){var i,n;return!!confirm("\u524a\u9664\u3057\u3066\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f")&&(n=$(this),i={type:"DELETE",data:"_method=delete",url:n.attr("href")+".json",dataType:"json",beforeSend:function(){return n.html(t.loading)},success:function(){if(n.data("remove"))return $(n.data("remove")).remove()},error:function(t){return alert(["== Error =="].concat(t.responseJSON).join("\n"))}},$.ajax($.extend(i,o)),e.preventDefault(),!1)})},t.confirmUnloading=function(){return $("input[type=text],textarea,select").change(function(){return $(window).on("beforeunload",function(){return"\u5165\u529b\u3057\u305f\u30c7\u30fc\u30bf\u306f\u4fdd\u5b58\u3055\u308c\u307e\u305b\u3093\u3002"})}),$("input[type=submit]").click(function(){return $(window).off("beforeunload")})},t}(),this.Opendata_Tooltips=function(){function t(){}return t.render=function(){var t;return t=$(".tooltip"),t.click(function(){var t,e,o,i,n;return $(".tooltip ul").hide(),e=$(this),o=e.find("ul").outerHeight(),i=e.offset(),i.top-o<0?(e.find("ul").css("bottom",o*-1-15+"px"),t="ul:after {border: 8px solid transparent; border-bottom-color:#fff; bottom:"+(o-5)+"px;}",n=$("<style>").append(document.createTextNode(t)),$(".tooltip ul style").remove(),e.find("ul").append(n)):(e.find("ul").css("bottom","18px"),t="ul:after {border: 8px solid transparent; border-top-color:#fff; bottom:-13px;}",n=$("<style>").append(document.createTextNode(t)),$(".tooltip ul style").remove(),e.find("ul").append(n)),e.find("ul").show()}),$(document).click(function(e){if(!t.is($(e.target).closest("div")))return $(".tooltip ul").hide()})},t}(),this.Opendata_ListUI=function(){function t(){}return t.render=function(){return $("table.od-modal tbody tr").each(function(){var e,o;return o=$(this),e=o.parent(),o.find(".tap-menu a").each(function(){if("/delete"===$(this).attr("href").slice(-7))return o.find(".tap-menu").after("<nav class='multiple-menu'><a href='multipleDelete' >\u3059\u3079\u3066\u524a\u9664\u3059\u308b</a></nav>")}),o.find("input[type=checkbox]").each(function(){return o.toggleClass("checked",$(this).prop("checked"))}),o.find("input[type=checkbox]").change(function(){var t,e,i,n,r;for(o.toggleClass("checked",$(this).prop("checked")),e=0,r=$("input[name='ids[]']"),i=0,n=r.length;i<n;i++)t=r[i],t.checked&&e++;if($("thead input[type=checkbox]").prop("checked",e>0&&$("input[name='ids[]']").length===e),!this.checked)return o.find(".multiple-menu").hide()}),o.find("input[type=checkbox]").mouseover(function(t){if(this.checked)return o.find(".multiple-menu").css("left",t.pageX+15).css("top",t.pageY-5).show()}),o.mouseup(function(t){if(!$(t.target).is("a")&&!$(t.target).is("input"))return e.find("input[type=checkbox]").attr("checked",!1),e.find("tr").removeClass("checked"),o.find(".tap-menu").css("left",t.pageX+2).css("top",t.pageY).show(),o.find("input[type=checkbox]").trigger("click")}),o.mouseleave(function(){return o.find(".tap-menu").hide(),o.find(".multiple-menu").hide()}),o.find(".multiple-menu a").on("click",function(e){var o,i,n,r;if("multipleDelete"===$(this).attr("href")){for(e.preventDefault(),r=$("input[name='ids[]']"),i=0,n=r.length;i<n;i++)if(o=r[i],o.checked){if(200!==t.deleteitem(o.value).status)return;o.checked=!1}return location.reload()}})}),$("thead input[type=checkbox]").change(function(){var t,e,o,i,n;for(i=$("input[name='ids[]']"),n=[],e=0,o=i.length;e<o;e++)t=i[e],n.push(t.checked=this.checked);return n})},t.deleteitem=function(t){return $.ajax({type:"post",url:location.pathname+"/"+t,async:!1,data:"_method=delete",success:function(){},error:function(t){return alert(["== Error =="].concat(t.statusText).join("\n"))}})},t}(),this.Opendata_SearchUI=function(){function t(){}return t.select=function(e){var o,i,n;n=$("<tr>").attr("data-id",e.id),i=$.colorbox.element().closest("dl").find(".hidden-ids").clone(!1),i=i.val(e.id).removeClass("hidden-ids"),o=$('<a class="deselect" href="#">\u524a\u9664</a>').on("click",t.deselect),n.append($("<td>").append($(i)).append(e.name)),n.append($("<td>").append($(o))),$.colorbox.element().closest("dl").find(".ajax-selected tbody").prepend(n)},t.deselect=function(t){return $(this).parents("tr:first").remove(),t.preventDefault()},t.toggleSelectButton=function(){return $("#ajax-box .items input:checkbox").filter(":checked").size()>0?$("#ajax-box .select-items").parent("div").show():$("#ajax-box .select-items").parent("div").hide()},t.render=function(){return $(".ajax-selected").each(function(){if($(this).find(".deselect").on("click",t.deselect),0===$(this).find(".deselect").size())return $(this).hide()})},t.modal=function(){return $("#ajax-box form.search").on("submit",function(t){return $(this).ajaxSubmit({url:$(this).attr("action"),success:function(t){return $("#cboxLoadedContent").html(t)},error:function(){return alert("== Error ==")}}),t.preventDefault()}),$.colorbox.element().closest("dl").find(".ajax-selected tr[data-id]").each(function(){var t;return t=$(this).attr("data-id"),$("#ajax-box .items [data-id="+t+"]").remove()}),Opendata_ListUI.render("table.od-modal"),$("#ajax-box a.select-item").on("click",function(e){var o,i;return o=$(this).closest("[data-id]").attr("data-id"),i=$(this).text(),t.select({id:o,name:i}),$.colorbox.element().closest("dl").find(".ajax-selected").show(),e.preventDefault(),$.colorbox.close()}),$("#ajax-box .select-items").on("click",function(e){return $("#ajax-box .items input:checkbox").filter(":checked").each(function(){var e,o;return e=$(this).closest("[data-id]").attr("data-id"),o=$(this).closest("[data-id]").find(".select-item").text(),""===o&&(o=$(this).closest("[data-id]").text()),t.select({id:e,name:o})}),$.colorbox.element().closest("dl").find(".ajax-selected").show(),e.preventDefault(),$.colorbox.close()}),$("#ajax-box .od-modal").on("change",function(){return t.toggleSelectButton()}),t.toggleSelectButton()},t}(),this.Opendata_HieraricalCheckbox=function(){function t(){}return t.render=function(){return $("label.parent input[type='checkbox']").on("change",function(){var t;return t=$(this).is(":checked"),$(this).closest("div.parent").find("input[type='checkbox']").prop("checked",t)})},t}()}).call(this);