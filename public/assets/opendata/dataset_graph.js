this.Opendata_Dataset_Graph=function(){function o(){}return o.graph=null,o.$canvas=null,o.$controller=null,o.render=function(e,t){$(".dataset-search a#ajax-search").colorbox({fixed:!0,width:"90%",height:"90%"}),o.$canvas=$(e),o.$controller=$(t),o.graph=new Opendata_Graph(o.$canvas,o.$controller)},o.renderGraph=function(e,n){var t=$('.selected-dataset [name="resource_id"]:checked:first');if(0<t.length){var c=$(t).data("url"),i=$(t).closest("li").find(".resource-name").text();e&&(c+="?type="+e),$.ajax({url:c,type:"GET",dataType:"json",success:function(e){var t=e.type,c=e.types,s=e.datasets,r=e.labels,a=e.headers;"pie"==t&&(n||(n=0),i+="\uff08"+a[n]+"\uff09"),o.graph.render(t,i,r,s,{headerIndex:n}),o.graph.renderController(c,a,function(e,t){o.renderGraph(e,t)})}})}else o.graph.destroy()},o.selectItem=function(e){$(e).attr("data-id");var t=$(e).find(".selected-item").clone(!1);$(t).find("a").removeClass("cboxElement"),$(t).find('[name="resource_id"]').each(function(){$(this).val();$(this).on("click",function(){$(this).closest(".selected-dataset").find('[name="resource_id"]').not(this).prop("checked",!1),o.renderGraph(),o.toggleFirstNotice()})}),$(t).find(".deselect").on("click",function(){return $(this).closest(".selected-item").remove(),o.graph.destroy(),o.toggleFirstNotice(),!1}),t.show(),$(".dataset-search .selected-dataset").append(t);for(var c=$(".dataset-search .selected-dataset .selected-item").length-10,s=0;s<c;s++)$(".dataset-search .selected-dataset .selected-item:first").remove();return o.toggleFirstNotice(),t},o.toggleSelectButton=function(){0<$(".search-ui .items input:checked").size()?$(".select-items").parent("div").show():$(".select-items").parent("div").hide()},o.toggleFirstNotice=function(){0<$('.selected-dataset [name="resource_id"]:checked').length?$(".resource-graph .first-notice").hide():$(".resource-graph .first-notice").show()},o.modal=function(){$(".search-ui-form form.search").on("submit",function(){return $(this).ajaxSubmit({url:$(this).attr("action"),success:function(e){return $("#cboxLoadedContent").html(e)},error:function(){return alert("== Error ==")}}),!1}),$(".search-ui a.select-item").on("click",function(){var e=$(this).closest("tr"),t=o.selectItem(e);return $.colorbox.close(),$(t).find(".set-graph:first").trigger("click"),!1}),$(".search-ui-select .select-items").on("click",function(){return $(".search-ui .items .set-dataset:checked").each(function(){var e=$(this).closest("tr");o.selectItem(e)}),$.colorbox.close(),!1}),$(".search-ui .list-head input:checkbox").on("change",function(){var e=$(this).prop("checked");$(".search-ui .list-item").each(function(){$(this).toggleClass("checked",e),$(this).find(".set-dataset").prop("checked",e)})}),$(".search-ui").on("change",function(){o.toggleSelectButton()}),$(".dataset-search .selected-dataset .selected-item").each(function(){var e=$(this).attr("data-id"),t=$(".items [data-id='"+e+"']");t.find("input[type=checkbox]").remove();var c=t.find(".select-item").html();t.find(".select-item").replaceWith("<span class='select-item' style='color: #888'>"+c+"</span>")})},o}();