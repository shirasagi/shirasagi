Opendata_Graph=function(t,e){this.$canvas=$(t),this.$container=$(t).parent("div"),this.$controller=$(e),this.chart=null},Opendata_Graph.prototype.render=function(t,e,a,s,i){if(null==i&&(i={}),this.type=t,this.name=e,this.labels=a,this.datasets=s,this.headerIndex=i.headerIndex,this.destroy(),this.headerIndex||0==this.headerIndex){var n=this.datasets[this.headerIndex];n&&(this.datasets=[n])}"bar"==this.type?this.drawBar():"line"==this.type?this.drawLine():"pie"==this.type&&this.drawPie()},Opendata_Graph.prototype.resizeContainer=function(t){var e=this.$container.data("baseWidth");e||(e=this.$container.width(),this.$container.data("baseWidth",e)),e<t?this.$container.css("width",t+"px"):this.$container.css("width",e+"px")},Opendata_Graph.prototype.datasetsMinWidth=function(){return 12*this.datasets.length*this.labels.length},Opendata_Graph.prototype.drawBar=function(){this.resizeContainer(this.datasetsMinWidth()),this.chart=new Chart(this.$canvas,{type:"bar",data:{labels:this.labels,datasets:this.datasets},options:{title:{display:!0,text:this.name,fontSize:18},legend:{display:!0,position:"bottom",onClick:function(){return!1}},plugins:{colorschemes:{scheme:"brewer.Paired12"}},scales:{xAxes:[{ticks:{autoSkip:!1}}],yAxes:[{ticks:{beginAtZero:!0,callback:function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}}]},responsive:!0,maintainAspectRatio:!1}})},Opendata_Graph.prototype.drawLine=function(){this.resizeContainer(this.datasetsMinWidth()),this.chart=new Chart(this.$canvas,{type:"line",data:{labels:this.labels,datasets:this.datasets},options:{title:{display:!0,text:this.name,fontSize:18},legend:{display:!0,position:"bottom",onClick:function(){return!1}},plugins:{colorschemes:{scheme:"brewer.Paired12"}},scales:{xAxes:[{ticks:{autoSkip:!1}}],yAxes:[{ticks:{beginAtZero:!0,callback:function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}}]},responsive:!0,maintainAspectRatio:!1}})},Opendata_Graph.prototype.drawPie=function(){this.resizeContainer(0),this.chart=new Chart(this.$canvas,{type:"pie",data:{labels:this.labels,datasets:this.datasets},options:{title:{display:!0,text:this.name,fontSize:18},legend:{display:!0,position:"bottom",onClick:function(){return!1}},tooltips:{callbacks:{label:function(t,e){var a=e.labels[t.index],s=e.datasets[t.datasetIndex];return e=(e=s.data[t.index]).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),a=a+"\uff08"+s.label+"\uff09: "+e}}},plugins:{colorschemes:{scheme:"brewer.Paired12"}},scales:{xAxes:[{display:!1}],yAxes:[{display:!1}]},responsive:!0,maintainAspectRatio:!1}})},Opendata_Graph.prototype.renderController=function(t,e,a){var s=this;this.types=t,this.headers=e,this.$controller.html("");var i={bar:"\u68d2\u30b0\u30e9\u30d5",line:"\u7dda\u30b0\u30e9\u30d5",pie:"\u5186\u30b0\u30e9\u30d5"},n=$('<div class="graph-types"></div>');if($.each(this.types,function(){var t=$('<button type="button" data-type="'+this+'">'+i[this]+"</button>");s.type==this&&t.addClass("current"),$(t).on("click",function(){a($(this).data("type"))}),$(n).append(t)}),this.$controller.append(n),"pie"==this.type&&this.headers&&0<this.headers.length){var r=$('<div class="graph-header-controller"></div>'),h=$('<select class="select-header" name="header-index"></select>');$.each(this.headers,function(t){s.headerIndex==t?$(h).append('<option value="'+t+'" selected="selected">'+this+"</option>"):$(h).append('<option value="'+t+'">'+this+"</option>")}),$(h).on("change",function(){a("pie",$(this).val())}),$(r).append(h),this.$controller.append(r)}this.$controller.show()},Opendata_Graph.prototype.destroy=function(){this.chart&&this.chart.destroy(),this.$controller&&this.$controller.html("")};